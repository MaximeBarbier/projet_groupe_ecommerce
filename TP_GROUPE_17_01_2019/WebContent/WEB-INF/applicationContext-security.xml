<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:sec="http://www.springframework.org/schema/security"
	xsi:schemaLocation="http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-4.1.xsd
		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

	<sec:http auto-config="true" use-expressions="true">

		<sec:intercept-url pattern="/listCat*"
			access="hasRole('ROLE_ADMIN_CAT')" />
		<sec:intercept-url pattern="/listProd*"
			access="hasAnyRole('ROLE_ADMIN_PROD','ROLE_ADMIN_CAT')" />
		<sec:intercept-url pattern="/guest*"
			access="hasRole('ROLE_GUEST')" />

		<sec:form-login login-page="/login.jsp"
			default-target-url="/listProd"
			authentication-failure-url="/login.jsp?error=true"
			login-processing-url="/login" 
			username-parameter="username"
			password-parameter="password" />

		<sec:remember-me remember-me-parameter="remember-me"
			token-validity-seconds="45475" />

		<sec:anonymous username="guest"
			granted-authority="ROLE_GUEST" />

		<sec:logout
			logout-success-url="/login.jsp?logout_message=true"
			logout-url="/logout" invalidate-session="true" />

		<sec:csrf disabled="true" />

		<sec:access-denied-handler
			error-page="/403.jsp" />


	</sec:http>

	<sec:authentication-manager>
		<sec:authentication-provider>

			<sec:jdbc-user-service
				data-source-ref="datasourceBean"
				users-by-username-query="select username,password, activated from users where username=?"
				authorities-by-username-query="select users.username,roles.role_name as authority from users, roles
			where users.username=? and users.id_user=roles.user_id" />

		</sec:authentication-provider>
	</sec:authentication-manager>

</beans>
